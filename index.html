<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="./materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="./materialize.min.js"></script>
</head>

<body>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper">
                <a href="#!" class="brand-logo" style="margin:3pt;">Questionnaire</a>
            </div>
        </nav>
    </div>

    <div id="section">
        <form action="#" id="quizform">

        </form>
        </br>
        <div style="text-align: center;"><button id="submit" class="waves-effect waves-light btn" onclick="submit()">Submit</button></div>
    </div>

    <!-- Modal Trigger -->
    <!-- Modal Structure -->
    <div id="modal1" class="modal">
        <div class="modal-content">
            <h4>评分结果</h4>
            <p id="result"></p>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-green btn-flat">关闭</a>
        </div>
    </div>

    <style>
        #section {
            padding: 10pt;
        }
    </style>
</body>

<script>
    const questions = [
        "1.是否经常有尿不尽的感觉?",
        "2.两次排尿时间是否经常小于2小时?",
        "3.是否经常有间断性排尿?",
        "4.是否经常有憋尿困难?",
        "5.是否经常有尿线变细现象?",
        "6.是否经常需要用力及使劲才能开始排尿?",
        "7.从入睡到早起一般需要起来排尿几次?",

        "8.如果在您今后的生活中始终伴有现在的排尿症状,您认为如何?",

        "9.对阴茎勃起及维持勃起有多少信心?",
        "10.受到性刺激后，有多少次阴茎能够坚挺进入阴道?",
        "11.性交时，有多少次能在进入阴道后保持阴茎勃起?",
        "12.性交时，保持勃起至性交完毕，有多大困难?",
        "13.尝试性交时是否感到满足?",

    ];
    const answers = [
        //            IPSS
        [
            "无",
            "少于1/5",
            "少于1/2",
            "1/2",
            "多于1/2",
            "几乎总是",
            ""
        ],
        [
            "无",
            "少于1/5",
            "少于1/2",
            "1/2",
            "多于1/2",
            "几乎总是",
            ""
        ],
        [
            "无",
            "少于1/5",
            "少于1/2",
            "1/2",
            "多于1/2",
            "几乎总是",
            ""
        ],
        [
            "无",
            "少于1/5",
            "少于1/2",
            "1/2",
            "多于1/2",
            "几乎总是",
            ""
        ],
        [
            "无",
            "少于1/5",
            "少于1/2",
            "1/2",
            "多于1/2",
            "几乎总是",
            ""
        ],
        [
            "无",
            "少于1/5",
            "少于1/2",
            "1/2",
            "多于1/2",
            "几乎总是",
            ""
        ],
        [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            ""
        ],
        //            QoL
        [
            "高兴",
            "满意",
            "大致满意",
            "还可以",
            "不太满意",
            "苦恼",
            "很糟"
        ],

        //            IIEF-5
        [
            "",
            "很低",
            "低",
            "中等",
            "高",
            "很高",
            ""
        ],
        [
            "无性活动",
            "几乎没有或完全没有",
            "只有几次",
            "有时或大约一半时候",
            "大多数时候",
            "几乎每次或每次",
            ""
        ],
        [
            "没有尝试性交",
            "几乎没有或完全没有",
            "只有几次",
            "有时或大约一半时候",
            "大多数时候",
            "几乎每次或每次",
            ""
        ],
        [
            "没有尝试性交",
            "非常困难",
            "很困难",
            "有困难",
            "有点困难",
            "不困难",
            ""
        ],
        [
            "没有尝试性交",
            "几乎没有或完全没有",
            "只有几次",
            "有时或大约一半时候",
            "大多数时候",
            "几乎每次或每次",
            ""
        ],

    ];


    document.addEventListener('DOMContentLoaded', function() {
        var elems = document.querySelector('#modal1');
        var instances = M.Modal.init(elems);
        instance = M.Modal.getInstance(elems);
    });

    for (let i = 0; i < questions.length; i++) {
        const ques = questions[i];
        let block = document.createElement("div");
        let question = document.createElement("p");
        question.innerText = ques;
        block.appendChild(question)
        for (let j = 0; j < answers[j].length; j++) {
            const ans = answers[i][j];
            let label = document.createElement("label")
            label.style.margin = "5pt";
            let radio = document.createElement('input')
            radio.setAttribute(
                "type",
                "radio"
            )
            value = (i == 8) ? j + 1 : j
            radio.setAttribute(
                "value",
                value
            )
            radio.setAttribute(
                "class",
                "with-gap"
            )
            radio.setAttribute(
                "name",
                "ques" + i
            )
            let span = document.createElement('span')
            span.innerText = ans

            if (span.innerText != "") {
                label.appendChild(radio);
                label.appendChild(span);
                block.appendChild(label);
                block.appendChild(document.createElement('br'));
            }

        }
        document.getElementById("quizform").appendChild(block)
    }

    function submit() {
        var ans = [];
        for (let i = 0; i < questions.length; i++) {
            let checked = document.querySelector("input[name='ques" + i + "']:checked");
            if (checked != null) {
                ans[i] = parseInt(checked.value);
            } else {
                alert("请全部填写后提交！");
                return;
            }
        }
        //
        let IPSS = 0;
        let QoL = 0;
        let IEFF5 = 0;
        for (let i = 0; i < ans.length; i++) {
            if (i < 7) {
                IPSS += ans[i];

            } else if (i == 8) {
                QoL = ans[i];
            } else {
                IEFF5 += ans[i];
            }
        }
        if (IPSS == 0) IPSSresult = "正常";
        else if (IPSS >= 1 && IPSS <= 7) IPSSresult = "轻度,建议咨询专科医师";
        else if (IPSS >= 8 && IPSS <= 19) IPSSresult = "中度,建议咨询专科医师";
        else IPSSresult = "重度,建议咨询专科医师";

        QoLResult = (QoL > 1) ? "异常，建议咨询专科医师" : "正常";

        if (IEFF5 >= 22) IEFF5result = "正常";
        else if (IEFF5 >= 12 && IEFF5 <= 21) IEFF5result = "轻度,建议咨询专科医师";
        else if (IEFF5 >= 8 && IEFF5 <= 11) IEFF5result = "中度,建议咨询专科医师";
        else IEFF5result = "重度,建议咨询专科医师";

        quizresult =
            'IPSS得分：' + IPSS + "\n结果" + IPSSresult + "\n" +
            'QoL得分：' + QoL + "\n结果" + QoLResult + "\n" +
            'IEFF5得分：' + IEFF5 + "\n结果" + IEFF5result + "\n";

        console.log("IPSS:" + IPSS + "\nQoL:" + QoL + "\nIEFF5:" + IEFF5);

        instance.open();
        document.querySelector("#result").innerText = quizresult;
    }
</script>

</html>